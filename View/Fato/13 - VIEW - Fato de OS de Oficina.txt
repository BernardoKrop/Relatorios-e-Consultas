CREATE OR REPLACE VIEW SBOTRUSTAGRO."vw_fOSOficina" AS
SELECT Ordem."DocEntry"         AS "NrOS",
       Ordem."U_CodFazenda"     AS "IdFazenda",
       Ordem."U_CodMotivo"      AS "IdMotivo",  
       Ordem."U_CodClassMa"     AS "IdClasse",
       CASE "U_Status"
         WHEN 'E' THEN 'Encerrada'
         WHEN 'A' THEN 'Aberta'
       END AS "Status",
	   CASE "U_Avanco" 
	   	 WHEN 'D' THEN 'Em Análise'
	   	 WHEN 'P' THEN 'Aguardando Peça'
	   	 WHEN 'S' THEN 'Aguardando Serviço'
	   	 WHEN 'E' THEN 'Em Execução'
	   	 WHEN 'F' THEN 'Finalizada'
	   	 WHEN 'N' THEN 'Aguardando NF do Forncedor'
	   END "Avanço",
       Ordem."U_CodEquipam"     AS "IdEquipamento",
       FLOOR("Tempo") || ':' || LPAD(FLOOR(("Tempo" - FLOOR("Tempo")) * 60), 2, '0') AS "TmpDecorrido",
       Ordem."Tempo"   AS "TmpNumero",
       TO_DATE(Ordem."U_DtEntrada") AS "DataEntrada",
       TO_DATE(Ordem."U_DtSaida")   AS "DataSaida",
       Ordem."U_CodOperador"        AS "IdOperador"
  FROM (SELECT CASE WHEN "U_DtSaida" IS NOT NULL 
         THEN ROUND(SECONDS_BETWEEN(TO_TIMESTAMP(TO_DATE("U_DtEntrada")||' '||"Agri_ConversaoIntHora"("U_HoraEntrada")),
                              TO_TIMESTAMP(TO_DATE("U_DtSaida")||' '||"Agri_ConversaoIntHora"("U_HoraEncerramento" ))) / 60/60,2)
         ELSE ROUND(SECONDS_BETWEEN(TO_TIMESTAMP(TO_DATE("U_DtEntrada")||' '||"Agri_ConversaoIntHora"("U_HoraEntrada")),
                              CURRENT_TIMESTAMP) / 60 /60,2)
       END AS "Tempo",
       *
  FROM "@AGRI_OSOF" ) Ordem
WHERE Ordem."Canceled"  = 'N';