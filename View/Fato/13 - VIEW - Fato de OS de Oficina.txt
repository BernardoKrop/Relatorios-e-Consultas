CREATE OR REPLACE VIEW "vw_fOSOficina"  AS 
SELECT Ordem."DocEntry"         AS "NumOS",
       Ordem."U_CodFazenda"     AS "CodFazenda",
       Ordem."U_CodMotivo"      AS "CodMotivo",  
       Ordem."U_CodClassMa"     AS "CodClasse",
       Ordem."U_Status"         AS "CodStatus", -- A = Alberto; E = Encerrado,
	   Ordem."U_Avanco"         AS "CodAvan√ßo",
       Ordem."U_CodEquipam"     AS "CodEquipamento",
       CASE WHEN Ordem."U_DtSaida" IS NOT NULL 
         THEN SECONDS_BETWEEN(TO_TIMESTAMP(TO_DATE(Ordem."U_DtEntrada")||' '||"Agri_ConversaoIntHora"(Ordem."U_HoraEntrada")),
                              TO_TIMESTAMP(TO_DATE(Ordem."U_DtSaida")||' '||"Agri_ConversaoIntHora"(Ordem."U_HoraEncerramento" ))) / 60 
         ELSE SECONDS_BETWEEN(TO_TIMESTAMP(TO_DATE(Ordem."U_DtEntrada")||' '||"Agri_ConversaoIntHora"(Ordem."U_HoraEntrada")),
                              CURRENT_TIMESTAMP)
       END AS "TmpDecorrido"
  FROM "@AGRI_OSOF" Ordem
WHERE Ordem."Canceled"  = 'N';
